openapi: 3.0.3
info:
  title: Arch Quiz Platform API
  version: 0.1.0
servers:
  - url: https://api.example.com
paths:
  /auth/register:
    post:
      summary: Register instructor
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201': { description: Created }
  /auth/login:
    post:
      summary: Login instructor
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200': { description: OK }
  /auth/logout:
    post:
      summary: Logout instructor
      responses:
        '204': { description: No Content }
  /auth/me:
    get:
      summary: Get current instructor
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /quizzes:
    get:
      summary: List quizzes for current instructor
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Quiz'
    post:
      summary: Create quiz
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuizCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Quiz'

  /quizzes/{quizId}:
    get:
      summary: Get quiz detail
      parameters:
        - $ref: '#/components/parameters/QuizId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Quiz'
    patch:
      summary: Update quiz
      parameters:
        - $ref: '#/components/parameters/QuizId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuizUpdate'
      responses:
        '200': { description: OK }

  /quizzes/{quizId}/status:
    patch:
      summary: Publish or close quiz
      parameters:
        - $ref: '#/components/parameters/QuizId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuizStatusUpdate'
      responses:
        '200': { description: OK }

  /quizzes/{quizId}/dashboard:
    get:
      summary: Get instructor dashboard metrics
      parameters:
        - $ref: '#/components/parameters/QuizId'
      responses:
        '200': { description: OK }

  /quizzes/{quizId}/students:
    get:
      summary: List students for quiz
      parameters:
        - $ref: '#/components/parameters/QuizId'
      responses:
        '200': { description: OK }
  /quizzes/{quizId}/students/upload:
    post:
      summary: Upload student CSV
      parameters:
        - $ref: '#/components/parameters/QuizId'
      requestBody:
        required: true
        content:
          text/csv:
            schema:
              type: string
      responses:
        '200': { description: OK }

  /quizzes/{quizId}/questions:
    get:
      summary: List questions for quiz
      parameters:
        - $ref: '#/components/parameters/QuizId'
      responses:
        '200': { description: OK }
  /quizzes/{quizId}/questions/upload:
    post:
      summary: Upload questions CSV
      parameters:
        - $ref: '#/components/parameters/QuizId'
      requestBody:
        required: true
        content:
          text/csv:
            schema:
              type: string
      responses:
        '200': { description: OK }

  /quizzes/{quizId}/invitations/send:
    post:
      summary: Send invitations to all students
      parameters:
        - $ref: '#/components/parameters/QuizId'
      responses:
        '202': { description: Accepted }
  /quizzes/{quizId}/invitations/resend:
    post:
      summary: Resend invitation to a student
      parameters:
        - $ref: '#/components/parameters/QuizId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InvitationResend'
      responses:
        '200': { description: OK }
  /quizzes/{quizId}/verify-otp:
    post:
      summary: Verify OTP and start attempt
      parameters:
        - $ref: '#/components/parameters/QuizId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OtpVerify'
      responses:
        '200': { description: OK }

  /quizzes/{quizId}/attempts:
    get:
      summary: List attempts for quiz
      parameters:
        - $ref: '#/components/parameters/QuizId'
      responses:
        '200': { description: OK }

  /attempts/{attemptId}/finish:
    post:
      summary: Submit quiz answers
      parameters:
        - $ref: '#/components/parameters/AttemptId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AttemptFinish'
      responses:
        '200': { description: OK }

  /attempts/{attemptId}/events:
    post:
      summary: Record suspicious event
      parameters:
        - $ref: '#/components/parameters/AttemptId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EventCreate'
      responses:
        '201': { description: Created }

  /quizzes/{quizId}/terminate:
    patch:
      summary: End exam for all participants
      parameters:
        - $ref: '#/components/parameters/QuizId'
      responses:
        '200': { description: OK }

  /quizzes/{quizId}/extend:
    patch:
      summary: Extend quiz end time
      parameters:
        - $ref: '#/components/parameters/QuizId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuizExtend'
      responses:
        '200': { description: OK }

components:
  parameters:
    QuizId:
      name: quizId
      in: path
      required: true
      schema:
        type: string
    AttemptId:
      name: attemptId
      in: path
      required: true
      schema:
        type: string
  schemas:
    RegisterRequest:
      type: object
      required: [name, email, password]
      properties:
        name: { type: string }
        email: { type: string, format: email }
        password: { type: string }
    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email: { type: string, format: email }
        password: { type: string }
    User:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        email: { type: string, format: email }
        role: { type: string }
    Quiz:
      type: object
      properties:
        id: { type: string }
        title: { type: string }
        description: { type: string }
        quizCode: { type: string }
        status: { type: string }
        settings: { $ref: '#/components/schemas/QuizSettings' }
    QuizCreate:
      type: object
      required: [title]
      properties:
        title: { type: string }
        description: { type: string }
        settings: { $ref: '#/components/schemas/QuizSettings' }
    QuizUpdate:
      type: object
      properties:
        title: { type: string }
        description: { type: string }
        settings: { $ref: '#/components/schemas/QuizSettings' }
    QuizStatusUpdate:
      type: object
      required: [status]
      properties:
        status: { type: string, enum: [draft, published, closed] }
    QuizSettings:
      type: object
      properties:
        questionTimeSeconds: { type: integer }
        totalTimeSeconds: { type: integer, nullable: true }
        startAt: { type: string, format: date-time, nullable: true }
        endAt: { type: string, format: date-time, nullable: true }
        shuffleQuestions: { type: boolean }
        shuffleOptions: { type: boolean }
        requireFullscreen: { type: boolean }
        logSuspiciousActivity: { type: boolean }
        allowMultipleAttempts: { type: boolean }
        showScoreToStudent: { type: boolean }
        mobileAllowed: { type: boolean }
        requireStudentListMatch: { type: boolean }
    InvitationResend:
      type: object
      required: [email]
      properties:
        email: { type: string, format: email }
    OtpVerify:
      type: object
      required: [email, otp]
      properties:
        email: { type: string, format: email }
        otp: { type: string }
    AttemptFinish:
      type: object
      required: [answers]
      properties:
        answers:
          type: array
          items:
            $ref: '#/components/schemas/Answer'
    Answer:
      type: object
      required: [questionId, selectedIndex]
      properties:
        questionId: { type: string }
        selectedIndex: { type: integer, nullable: true }
    EventCreate:
      type: object
      required: [type]
      properties:
        type: { type: string }
        message: { type: string }
        extra: { type: object }
    QuizExtend:
      type: object
      required: [minutes]
      properties:
        minutes: { type: integer }
